blueprint:
  name: "DF sequence of Operation - Full Cycle"
  description: "DF sequence of Operation - Full Cycle"
  domain: automation
  input:
    calendar_df_weh:
      name: Calendar DF WEH
      description: "The calendar entity that triggers DF events"
      selector:
        entity:
          filter:
            - domain: calendar

trigger:
  - platform: state
    entity_id: calendar.df_weh
    from: "off"
    to: "on"
    id: start_df_event
    alias: Calendar event for DF turns on
action:
  - variables:
      t_delta: |-
        {% if is_state('calendar.df_weh', 'on') %}
          {{ float((state_attr('calendar.df_weh', 'description') | from_json)['T_delta'], 0)  }}
        {% else %}
          0
        {% endif %}
      season: |-
        {% if is_state('calendar.df_weh', 'on') %}
          {{ (state_attr('calendar.df_weh', 'description') | from_json)['season']  }}
        {% else %}
          {{ '' }}
        {% endif %}
      df_delta_multiplier: |-
        {% if is_state('calendar.df_weh', 'on') %}
          {% if (state_attr('calendar.df_weh', 'description') | from_json)['season'] == 'cooling' %}
            {{ float(1, 0) }}
          {% elif (state_attr('calendar.df_weh', 'description') | from_json)['season'] == 'heating' %} 
            {{ float(-1, 0) }}
          {% else %}
              0
          {% endif %}
        {% endif %}
    alias: test action bp import